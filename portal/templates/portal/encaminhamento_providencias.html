{% extends 'base.html' %}
{% block title %}Encaminhamentos{% endblock %}
{% block class_encaminhamento_menu %}active{% endblock %}
{% block class_encaminhamento_pendente_item %}collapsible-header active{% endblock %}
{% load widget_tweaks %}

{% block breadcrumb_base %}
    <ol class="breadcrumb blue-grey lighten-4">
        <li class="breadcrumb-item"><a href="{% url 'home' %}">Início</a></li>
        <li class="breadcrumb-item"><a href="{% url 'encaminhamento_pendente' %}">Encaminhamentos pendentes</a></li>
        <li class="breadcrumb-item active">Retorno de encaminhamento</li>
    </ol>
{% endblock %}

{% block content %}
    <div class="row mb-4">
        <div class="col-sm-12">
            <div class="card redonda">
                <div class="card-header redonda grey lighten-1 font-weight-bold">
                    DADOS DO ENCAMINHAMENTO
                </div>
                <div class="card-body">
                    <form action="{% url 'encaminhamento_providencia' encaminhamento.id %}" method="POST"
                          onsubmit='disableButton()'>
                        {% csrf_token %}
                        <div class="form-row">
                            <div class="col-sm-6">
                                <div class="table-responsive">
                                    <table class="table table-sm table-bordered">
                                        <tr>
                                            <td>
                                                <p style="font-weight: bold">
                                                    DATA
                                                </p>
                                                {{ encaminhamento.data }}
                                            </td>
                                            <td>
                                                <p style="font-weight: bold">
                                                    CURSO E TURMA
                                                </p>
                                                {{ encaminhamento.matricula.turma }}
                                            </td>
                                        </tr>
                                        <tr>
                                            <td colspan="3">
                                                <p style="font-weight: bold">
                                                    ESTUDANTE
                                                </p>
                                                {{ encaminhamento.matricula.aluno }}
                                            </td>
                                        </tr>
                                        <tr>
                                            <td colspan="3">
                                                <p style="font-weight: bold">
                                                    CATEGORIA DO ENCAMINHAMENTO
                                                </p>
                                                {{ encaminhamento.servico.categoria.descricao|upper }}<br>
                                                {{ encaminhamento.servico.descricao }}
                                            </td>
                                        </tr>
                                        <tr>
                                            <td colspan="3">
                                                <p style="font-weight: bold">
                                                    DESCRIÇÃO DO ENCAMINHAMENTO
                                                </p>
                                                {{ encaminhamento.descricao }}
                                            </td>
                                        </tr>
                                        {% if encaminhamento.outras_informacoes %}
                                            <tr>
                                                <td colspan="3">
                                                    <p style="font-weight: bold">
                                                        OUTRAS INFORMAÇÕES
                                                    </p>
                                                    {{ encaminhamento.outras_informacoes }}
                                                </td>
                                            </tr>
                                        {% endif %}
                                        <tr>
                                            <td colspan="3" style="text-align: center">
                                                <p style="font-weight: bold; text-align: left">
                                                    ENCAMINHADO POR
                                                </p>
                                                <strong>{{ encaminhamento.user|upper }}</strong><br>
                                                SIAPE: {{ encaminhamento.user.userprofile.siape }}
                                            </td>
                                        </tr>
                                    </table>
                                </div>
                            </div>
                            <div class="col-sm-6">
                                <div class="md-form">
                                    <label>{{ form.providencias.label }}</label>
                                    {{ form.providencias|attr:'autofocus' }}
                                </div>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="col-sm-12">
                                <div class="float-right">
                                    <button id=btn_enviar type="submit" class="btn btn-rounded btn-success"
                                            data-toggle="tooltip"
                                            data-placement="top" title="Salvar"><i class="fa fa-check"></i></button>
                                    <a href="{% url 'encaminhamento_pendente' %}" class="btn btn-rounded btn-danger"
                                       data-toggle="tooltip" data-placement="top" title="Cancelar"><i
                                            class="fa fa-close"></i></a>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
{% endblock %}

{% block script %}
    <script>
        function disableButton() {
            var btn = document.getElementById('btn_enviar');
            btn.disabled = true;
            btn.innerText = 'Atualizando...'
        }
    </script>
{% endblock %}